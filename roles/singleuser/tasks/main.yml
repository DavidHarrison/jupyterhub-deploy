---
- name: stop and remove running singleuser containers
  docker:
    docker_api_version: "{{ docker_api_version }}"
    state: absent
    image: systemuser
  sudo: yes

- name: create the systemuser directory
  file: path=/srv/systemuser state=directory
  sudo: yes

- name: copy the Dockerfile to the systemuser directory
  copy:
    src: Dockerfile
    dest: /srv/systemuser/Dockerfile
  sudo: yes
  tags:
    - rebuild-systemuser

- name: build systemuser image
  shell: docker build -t systemuser /srv/systemuser
  sudo: yes
  tags:
    - rebuild-systemuser

